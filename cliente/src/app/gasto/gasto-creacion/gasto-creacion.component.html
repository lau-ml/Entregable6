<div id="cargarRecibo">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Cargar gasto</h4>

      </div>
      <div class="modal-body">
        <form [formGroup]="formulario" enctype="multipart/form-data">
          <div class="form-group">
            <label for="monto">Monto del gasto:</label>
            <input class="form-control" formControlName="monto" id="monto" type="number">
          </div>
          <div class="form-group">
            <label for="fecha">Fecha del gasto:</label>
            <input placeholder="dd/mm/yyyy" class="form-control" formControlName="fecha" id="fecha" type="date">
          </div>
          <div class="form-group">
            <label for="imagen">Imagen asociada:</label>
            <input (change)="onChange($event)" class="form-control" formControlName="imagen" id="imagen" type="file"
                   accept="image/*">
          </div>


          <div class="form-group">
            <label for="division">Forma de dividir el gasto entre integrantes:</label>
            <ng-select formControlName="division" id="division">
              <ng-option [disabled]="true">--Seleccione una opción--</ng-option>
              <ng-option value="PORCENTAJE">Porcentaje por integrante</ng-option>
              <ng-option value="MONTOIGUAL">Igual monto para todos</ng-option>
              <ng-option value="MONTO">Montos fijos por integrante</ng-option>
              <ng-option value="PORCENTAJEIGUAL">Igual % para todos</ng-option>
            </ng-select>
          </div>

          <div class="form-group">
            <label for="tipo">Tipo de gasto:</label>
            <ng-select  formControlName="tipo" id="tipo">
              <ng-option [disabled]="true">--Seleccione una opción--</ng-option>
              <ng-option value="COMIDA">Comida</ng-option>
              <ng-option value="COMBUSTIBLE">Combustible</ng-option>
              <ng-option value="ALOJAMIENTO">Alojamiento</ng-option>
              <ng-option value="ENTRADAS">Entradas</ng-option>
            </ng-select>
          </div>
          <div
            *ngIf="formulario.get('division')?.value!='--Seleccione una opción--' && formulario.get('tipo')?.value !='--Seleccione una opción--'">


            <div class="form-group">
              <label for="grupoBool">¿Es un gasto grupal?</label>
              <input (change)="gastoGrupalCheck($event)" formControlName="grupoBool" class="mx-2" id="grupoBool"
                     type="checkbox">

            </div>
            <div class="form-group" *ngIf="formulario.get('grupoBool')?.value">
              <label for="id_grupo">Grupo</label>
              <ng-select (change)="cambioGrupo($event)"  formControlName="id_grupo" id="id_grupo">
                <ng-option  [disabled]="true" [value]="">--Seleccione una opción--</ng-option>
                <ng-option *ngFor="let grupo of grupos" [value]="grupo.id">{{ grupo.nombre }}</ng-option>
              </ng-select>

            </div>
            <div
              *ngIf="!formulario.get('grupoBool')?.value || (formulario.get('grupoBool')?.value) && formulario.get('id_grupo')?.value !='--Seleccione una opción--'">
              <div class="form-group">
                <label>
                  Participantes del gasto
                  <button *ngIf="personasFormArray.length < integrantes.length" (click)="agregarUsuario()"
                          class="btn btn-primary" type="button"><i class="fa-solid fa-plus"></i></button>
                </label>
              </div>
              <div *ngFor="let usuario of personasFormArray.controls; let i = index"
                   formArrayName="personas">
                <div [formGroupName]="i" class="d-flex flex-row">
                  <div class="col-4">
                    <label [attr.for]="'usuario' + i">Usuario:</label>

                    <ng-select (focus)="antesCambioUsuario(i)" (change)="cambioUsuario($event, i)"
                               (clear)="eliminarSeleccion(i)"
                            [attr.id]="'usuario' + i"  formControlName="usuario">
                      <ng-option  [disabled]="true">--Seleccione una opción--</ng-option>
                      <ng-option [disabled]="chequearSeleccionado(persona,i)"
                              *ngFor="let persona of integrantes; let j=index"
                              [value]="persona">{{ persona }}
                      </ng-option>
                    </ng-select>
                  </div>
                  <div
                    *ngIf="formulario.get('division')?.value != 'MONTOIGUAL' && formulario.get('division')?.value !='PORCENTAJEIGUAL' "
                    class="col-4">

                    <label *ngIf="formulario.get('division')?.value == 'MONTO'" [attr.for]="'monto' + i">Monto:</label>
                    <label *ngIf="formulario.get('division')?.value == 'PORCENTAJE'"
                           [attr.for]="'monto' + i">Porcentaje:</label>

                    <input [attr.id]="'monto' + i" class="form-control" formControlName="monto" type="text">
                  </div>
                  <div class="col-1 d-flex flex-column">
                    <label for="eliminar_usuario">Quitar </label>
                    <button (click)="eliminarUsuario(i)" class="btn btn-danger d-flex justify-content-center"
                            type="button" id="eliminar_usuario"><i class="fa-solid fa-x"></i>
                    </button>

                  </div>

                </div>
              </div>
              <div class="form-group mt-3">
                <label for="responsable">Responsable: </label>
                <ng-select formControlName="responsable" id="responsable">
                  <ng-option  [disabled]="true">--Seleccione una opción--</ng-option>
                  <ng-option *ngFor="let persona of seleccionCargado.keys()" [value]="persona">{{ persona }}</ng-option>
                </ng-select>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button (click)="resetearForm()" class="btn btn-secondary" data-bs-dismiss="modal" type="button">Cancelar
        </button>
        <button (click)="crearGasto()" class="btn btn-primary" data-bs-dismiss="modal" type="button">Guardar Recibo
        </button>

      </div>
    </div>
  </div>
</div>
